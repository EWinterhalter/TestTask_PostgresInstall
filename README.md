## Консольное приложение, которое устанавливает PostgreSQL на хост, настраивает и запускает

Предусловие для запуска: \
Оба сервера имеют ssh подключения.\
На серверах установлены базовые утилиты например procps.\
Сервера поддерживают systemd.

## Запуск
1. Склонировать репозиторий и перейти в его корневую папку
2. Сделать файл intall.sh исполняемым
```
chmod +x install.sh
```
3. Запустить файл и написать адреса подключений через запятую без пробелов.
```
./install.sh 192.168.8.106,192.168.8.107
```
## Как это работает
Программа считывает в массив адреса, введенные пользователем, затем перебирает,проверяя возможность подключения по ssh. \
Анализирует среднюю нагрузку (load average) на доступных серверах и определяет наименьшую. \
Установлены обработчики ошибок, которые сработают, если невозможно подключиться, нет доступных серверов или возникают проблемы с Ansible. 

Когда целевой сервер, с наименьшей нагрузкой, выбран запускается Ansible Playbook на сервере с наименьшей загрузкой. \
Второй сервер передается как параметр(переменная student_ip)\
Выполняется роль, которая определяет ОС (Debian или RHEL-семейство) и выполняет соответствующий файл с тасками.

В исполняемых файлах выполнятся: установка необходимых компонентов, редактирование конфигурации для подключений, создание бд и тестовый запрос.

## Выполнение задания
В основном сложности вызвали различия между дистрибутивами. Создать ansible для Debain не составило трудностей, для RHEL же возникли некоторые проблемы. Например PostgreSQL на RedHat намного строже относится к табуляции в файлах конфигурации, а так же использует scram-sha-256, а не md5 что я сначала не учла. Чтобы это обнаружить я смотрела журнал на вирутальной машине, которую использовала для тестирования.

Изначально, я думала, что отличия установки PostgreSQL будут минимальны и я смогу обойтись условием when и уместить все в один Playbook, но различий оказалось достаточно много, поэтому было принято решение использовать отдельные файлы. 

## Что можно улучшить
Версия PostgreSQL. Ставится та версия PostgreSQL, которая изначально предлагается в пакетных менеджерах (13). Это достаточно старая версия, стоит реализовать установку более новой версии.

Архитектуру Ansible. Возможно стоит вынести какие то таски в другие файлы и просто перебирать файлы.
